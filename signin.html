<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ExTremeData â€” Sign In</title>
  <meta name="description" content="Sign in to X-TrameData" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  
  <!-- Supabase JS -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  
  <style>
    /* CSS remains the same */
    :root{
      --bg:#0f1724; --card:#0b1220; --muted:#9aa7bf; --accent:#6ee7b7;
      --accent-2:#7c5cff; --radius:14px;
      font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#061028 0%, #071226 60%);color:#e6eef8}
    .container{min-height:100vh;display:grid;place-items:center;padding:36px}
    .card{width:480px;max-width:100%;border-radius:var(--radius);overflow:hidden;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));box-shadow:0 10px 30px rgba(2,6,23,0.7)}
    .form-wrap{padding:36px 44px;display:flex;flex-direction:column;gap:18px}
    h2{margin:6px 0 0 0;font-size:22px}
    p.lead{margin:0;color:var(--muted);font-size:13px}
    form{display:grid;gap:16px;margin-top:8px}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    input[type="text"],input[type="email"],input[type="password"]{width:100%;padding:12px 14px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit;font-size:14px}
    .actions{display:flex;gap:12px;align-items:center;margin-top:8px;flex-wrap:wrap}
    .btn{background:linear-gradient(90deg,var(--accent),var(--accent-2));padding:12px 16px;border-radius:11px;color:#05232a;border:none;font-weight:700;cursor:pointer;width:100%; display:flex; align-items:center; justify-content:center;}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);font-weight:600;width:100%}
    .btn:disabled{opacity:0.5;cursor:not-allowed}
    .error{color:#ff8181;font-size:13px; min-height: 1em;}
    .success{color:var(--accent);font-size:13px; min-height: 1em;}
    .hint{font-size:12px;color:var(--muted)}
    .forgot{font-size:12px;color:var(--accent-2);cursor:pointer;text-align:right}
    .overlay{position:fixed;inset:0;display:none;place-items:center;background:rgba(1,6,14,0.6);z-index:40;opacity:0;transition:opacity 0.3s ease;}
    .overlay.show{display:grid;opacity:1;}
    .modal{background: var(--card); padding:26px; border-radius:14px; min-width:320px; text-align:center; display:flex; flex-direction:column; gap:14px; transform:scale(0.8); transition:transform 0.3s ease;}
    .overlay.show .modal{transform:scale(1);}
    .loading{display:inline-block;width:16px;height:16px;border:2px solid rgba(255,255,255,0.2);border-radius:50%;border-top-color:#fff;animation:spin 1s ease-in-out infinite;margin-left:8px}
    @keyframes spin{to{transform:rotate(360deg)}}
    .input-wrapper { position: relative; }
    .pw-toggle { position: absolute; right: 14px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; padding: 0; display: grid; place-items: center; color: var(--muted); }
    input[type="password"] { padding-right: 40px; }
    .pw-toggle svg { width: 18px; height: 18px; }
    .pw-toggle .eye-off { display: none; }
    .pw-toggle.visible .eye { display: none; }
    .pw-toggle.visible .eye-off { display: block; }
  </style>
</head>
<body>
  <div class="container">
    <div class="card" role="region" aria-label="Sign In card">
      <main class="form-wrap">
        <div>
          <h2>Sign in to X-TrameData</h2>
          <p class="lead">Enter your credentials to access your account.</p>
        </div>
        <form id="loginForm" novalidate>
          <div>
            <label for="loginEmail">Email</label>
            <input id="loginEmail" name="loginEmail" type="email" required autocomplete="email">
            <div class="error" id="err-loginEmail" aria-live="polite"></div>
          </div>
          <div>
            <label for="loginPassword">Password</label>
            <div class="input-wrapper">
              <input id="loginPassword" name="loginPassword" type="password" required autocomplete="current-password">
              <button type="button" class="pw-toggle" id="togglePassword" aria-label="Show password">
                <svg class="eye" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                <svg class="eye-off" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9.88 9.88a3 3 0 1 0 4.24 4.24"></path><path d="M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68"></path><path d="M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61"></path><line x1="2" x2="22" y1="2" y2="22"></line></svg>
              </button>
            </div>
            <div class="error" id="err-loginPassword" aria-live="polite"></div>
          </div>
          <div class="forgot" id="forgotBtn">Forgot Password?</div>
          <div class="actions">
            <button class="btn" type="submit" id="submitBtn">
              <span>Sign In</span>
              <span class="loading" id="loadingSpinner" style="display:none"></span>
            </button>
            <button class="btn ghost" type="button" id="demoLoginBtn">Use Demo Account</button>
          </div>
          <div style="text-align:center;margin-top:8px;color:var(--muted);font-size:13px">
            Don't have an account? <a href="index.html" style="color:var(--accent-2)">Sign up</a>
          </div>
        </form>
      </main>
    </div>
  </div>
  <!-- Modals remain the same -->
  <div class="overlay" id="forgotOverlay" role="dialog" aria-modal="true">...</div>

<script>
// --- SUPABASE SETUP ---
const SUPABASE_URL = 'https://nzwrrahwgtisyxouplnu.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im56d3JyYWh3Z3Rpc3l4b3VwbG51Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU5MDk1NzAsImV4cCI6MjA3MTQ4NTU3MH0.kvc0VtfT_isXxP4i9XCzUiwOVLVl7Hni6rSXmIAaLHw';
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

document.addEventListener('DOMContentLoaded', () => {
  const form = document.getElementById('loginForm');
  const submitBtn = document.getElementById('submitBtn');
  const loadingSpinner = document.getElementById('loadingSpinner');
  
  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const email = document.getElementById('loginEmail').value.trim();
    const password = document.getElementById('loginPassword').value;

    let ok = true;
    showError('err-loginEmail','');
    showError('err-loginPassword','');
    if(!email){ showError('err-loginEmail','Email is required'); ok=false;}
    if(!password){ showError('err-loginPassword','Password is required'); ok=false;}
    if(!ok) return;

    submitBtn.disabled = true;
    loadingSpinner.style.display = 'inline-block';
    
    try {
      const { data: authData, error: authError } = await supabase.auth.signInWithPassword({
        email: email,
        password: password,
      });

      if (authError) throw authError;

      const { data: profileData, error: profileError } = await supabase
        .from('user_profiles')
        .select('first_name, last_name, plan')
        .eq('id', authData.user.id)
        .single();
      
      if (profileError) throw profileError;

      const userData = {
        email: authData.user.email,
        firstName: profileData.first_name,
        lastName: profileData.last_name,
        plan: profileData.plan
      };
      localStorage.setItem("userData", JSON.stringify(userData));
      
      window.location.href = "data.html";

    } catch (error) {
      console.error('Login Error:', error);
      // --- MODIFIED & IMPROVED ERROR HANDLING ---
      if (error.message.includes("Email not confirmed")) {
        showError('err-loginEmail', 'Please check your inbox to confirm your email address first.');
      } else if (error.message.includes("Invalid login credentials")) {
        showError('err-loginPassword', 'Invalid email or password. Please try again.');
      } else {
        showError('err-loginPassword', error.message);
      }
    } finally {
      submitBtn.disabled = false;
      loadingSpinner.style.display = 'none';
    }
  });

  // --- ALL OTHER SCRIPT LOGIC REMAINS THE SAME ---
  setupPasswordToggle('loginPassword', 'togglePassword');
  document.getElementById('demoLoginBtn').addEventListener('click', () => { /* ... */ });
  // Forgot password logic remains the same
  // Helper functions remain the same
});

// Helper Functions
function showError(id, msg) { const el = document.getElementById(id); if(el) el.textContent = msg || ''; }
function showSuccess(id, msg) { const el = document.getElementById(id); if(el) el.textContent = msg || ''; }
function setupPasswordToggle(inputId, buttonId) {
  const passwordInput = document.getElementById(inputId);
  const toggleButton = document.getElementById(buttonId);
  if (!passwordInput || !toggleButton) return;
  toggleButton.addEventListener('click', () => {
    const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
    passwordInput.setAttribute('type', type);
    toggleButton.classList.toggle('visible');
  });
}
</script>

</body>
</html>
